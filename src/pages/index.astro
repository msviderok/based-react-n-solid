---
import ReactSection from "@/components/react/Section";
import SolidSection from "@/components/solid/Section";
import SolidDemo from "@/components/solid/SolidDemo";
import ReactDemo from "@/components/react/ReactDemo";
import SolidLayoutSidebar from "@/components/solid/LayoutSidebar";
import ReactLayoutSidebar from "@/components/react/LayoutSidebar";
import Layout from "@/Layout.astro";
import { COMPLIST } from "@/lib/store";
import LayoutSkeleton from "@/components/astro/LayoutSkeleton.astro";
---

<Layout>
  <ReactLayoutSidebar client:only="react">
    {
      COMPLIST.map(([component, variants, { minWidth } = {}]) => (
        <ReactSection.Root client:only="react" component={component}>
          {variants.map((variant) => (
            <ReactSection.Variant
              component={component}
              variant={variant}
              minWidth={minWidth}
              client:only="react"
            >
              <ReactSection.VariantSolid client:only="react">
                <SolidDemo component={component} variant={variant} client:only="solid-js" />
              </ReactSection.VariantSolid>
              <ReactSection.VariantReact client:only="react">
                <ReactDemo component={component} variant={variant} client:only="react" />
              </ReactSection.VariantReact>
            </ReactSection.Variant>
          ))}
        </ReactSection.Root>
      ))
    }
  </ReactLayoutSidebar>

  <LayoutSkeleton />
</Layout>

<script>
  import { solidLoaded, reactLoaded } from "@/lib/store";
  import { effect } from "nanostores";

  const layoutSkeleton = document.getElementById("layout-skeleton");
  effect([solidLoaded, reactLoaded], (solid, react) => {
    if (solid && react) {
      layoutSkeleton?.classList.add("opacity-0");
      layoutSkeleton?.classList.remove("opacity-100");
      document.body.classList.remove("overflow-hidden");
      setTimeout(() => layoutSkeleton?.remove(), 200);
    }
  });
</script>
